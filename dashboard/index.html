<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width" />
	<title>Distributed Hash Breaker - Dashboard</title>
	<link href="css/style.css" rel="stylesheet" />

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous" />
	<link href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" rel="stylesheet" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous">
</head>
<body>
	<!-- HEADER -->
    <div class="top-bar">
        <div class="content-wrapper">
			<img src="http://www.biolab.ing.unipi.it/sites/default/files/unipi.png">
			<p class="top-bar-title">Distributed Hash Breaker</p>
			<p class="top-bar-subtitle">CONCURRENT AND DISTRIBUTED SYSTEMS PROJECT</p>
		</div>
	</div>
	<div style="
		margin-bottom: 16px;
	">
		<div class="pure-menu pure-menu-horizontal">
				<ul class="pure-menu-list">
					<li class="pure-menu-item pure-menu-selected"><a href="#" class="pure-menu-link">Current attack</a></li>
					<li class="pure-menu-item"><a href="#" class="pure-menu-link">Plan new attack</a></li>
					<li class="pure-menu-item"><a href="#" class="pure-menu-link">Revoke attack</a></li>
					<li class="pure-menu-item pure-menu-disabled">Preferences</li>
				</ul>
			</div>
	</div>
	
	<!-- MAIN CONTENT -->
	<section id="main-section" class="content-wrapper">
		<!-- MAIN SECTION -->
		<h2 class="title"> Dashboard </h2>
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">attack #001 - progress</h4>
				<div class="progress-bar"><span style="width:40%">40%</span></div>
				<span class="info-text"><b>Expected time</b>: 2h 30m</span>
			    <canvas id="myChart"></canvas>
            </div>
		</div>
		
		<!-- THREE CARD ROW -->
		<div class="pure-g">
			<div class="pure-u-1-4">        
				<div class="card">
					<div class="card-body">
						<h4 class="card-title align-center">collisions found</h4>
						<span class="info-card-text"> <i class="fas fa-arrow-up"></i> 1234</span>
					</div>
				</div>
			</div>
			<div class="pure-u-3-4">
				<div class="card">
					<div class="card-body">
						<h4 class="card-title">Other info</h4>
					</div>
				</div>				
			</div>
		</div>
		</div>
	</section>
	
	<section id="bucket-inspection" class="content-wrapper"> 
		<h2>Bucket Inspection</h2>

		<div id="bucket-inspector" class="card">
			<div class="card-body">
				<h4 id="bucket-id" class="card-title">Bucket 1</h4>
				<div class="progress-bar"><span id="bucket-progress"></span></div>
				<span class="info-text"><b>Assigned to </b>: username</span>
				<span class="info-text"><b>Date</b>: 10-02-2019</span>
				<span class="info-text"><b>Last heartbeat</b>: 12-02-2019 10:37</span>
				<button>revoke</button>
			</div>
		</div>

		<div class="pure-g">
			<div class="pure-u-2-3">
				<div class="card">
					<div class="card-body">
						<h4 class="card-title">Heatmap</h4>
						<!-- Bucket heatmap -->
						<div id="heatmap">
						</div>
					</div>
				</div>
			</div>
			
			<div class="pure-u-1-3">
				<div class="card">
					<div class="card-body">
						<h4 class="card-title">Allocation</h4>
						<canvas id="bucket-allocation-chart"></canvas>
					</div>
				</div>
			</div>
		</div>
	</section>

    <!-- INCLUDE SCRIPTS -->
	<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> 
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@2.9.0/dist/Chart.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
   
   <script>
        var config = {
			type: 'line',
			data: {
				labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
				datasets: [{
					label: 'My First dataset',
					backgroundColor:"#ec407a",
					borderColor:"#ec407a",
					data: [
						15,
						115,
						15,
						315,
						145,
						155,
						144
					],
					fill: false,
				}, {
					label: 'My Second dataset',
					fill: false,
					backgroundColor: "#536de6",
					borderColor: "#536de6",
					data: [
						123,
						133,
						144,
						122,
						151,
						125,
						145
					],
				}]
			},
			options: {
				aspectRatio: 2,
				responsive: true,
				title: {
					display: true,
					text: 'Some kind of Performance Chart'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Month'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Value'
						}
					}]
				}
			}
		};
        var ctx = document.getElementById('myChart').getContext('2d');
		var myChart = new Chart(ctx, config);
		
		var bucketAllocationCtx = document.getElementById('bucket-allocation-chart').getContext('2d');
		var bucketAllocationChart = new Chart(bucketAllocationCtx, {
			type: 'doughnut',
			data: {
				datasets: [{
					data: [30, 20, 10],
					backgroundColor: [
						"#fff48f",
						"#3cba9f",
						"#e2eaef"
					]
				}],

				// These labels appear in the legend and in the tooltips when hovering different arcs
				labels: [
					'Working',
					'Completed',
					'Available'
				]
			}
			,
			options: {
				legend: {
					display: true,
					position: "right"
				},
				responsive: true
			}
		});

		var buckets = [];

		$( document ).ready(function() {
			// generate random heatmap
			var heatmap = $("#heatmap");
			var N = 35;

			for(i=0; i<N; i++) {
				var percentage = Math.random();
				buckets.push({id:i, percentage: percentage});
				heatmap.append("<div id='bucket-" + i + "' onclick='load_bucket(" + i +")' style='opacity:" + 0.5 + ";'>" + i +  "</div")

				// THIS IS REALLY BAD AND IT SHOULD BE CHANGED SOMEHOW
				var bucket_style = ['bucket-l-25', 
									'bucket-m-25',
									'bucket-m-50',
									'bucket-m-75'];
				
				$('#bucket-'+i).addClass(bucket_style[Math.floor(percentage*4)]);
			}
		});

		function load_bucket(bucket) {
			var percentage = Math.floor(buckets[bucket].percentage * 100);
			$("#bucket-inspector").slideDown();
			$("#bucket-id").text("Bucket " + bucket);
			$("#bucket-progress").css("width", percentage + "%");
			$("#bucket-progress").text(percentage + "%");
		}
    </script>
</body>
</html>
