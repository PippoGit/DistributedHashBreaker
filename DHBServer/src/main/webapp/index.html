<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Distributed Hash Breaker - Dashboard</title>
        <link href="css/style.css" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700,800,900&display=swap" rel="stylesheet"/>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet" crossorigin="anonymous"/>
        <link href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" rel="stylesheet" crossorigin="anonymous"/>
    </head>
    <body>
        <!-- HEADER -->
        <div class="top-bar">
            <div class="content-wrapper">
                <img src="img/unipi.png" alt="unipi_logo">
                <p class="top-bar-title">Distributed Hash Breaker</p>
                <p class="top-bar-subtitle">CONCURRENT AND DISTRIBUTED SYSTEMS PROJECT</p>
            </div>
        </div>
        <div class="menu-wrapper">
            <div class="pure-menu pure-menu-horizontal">
                <ul class="pure-menu-list">
                    <li class="pure-menu-item pure-menu-selected"><a href="#" class="pure-menu-link">Current attack</a></li>
                    <li class="pure-menu-item"><a href="#" class="pure-menu-link">Plan new attack</a></li>
                    <li class="pure-menu-item"><a href="#" class="pure-menu-link">Revoke attack</a></li>
                    <li class="pure-menu-item pure-menu-disabled">Preferences</li>
                </ul>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <section id="main-section" class="content-wrapper">
            <!-- MAIN SECTION -->
            <h2 class="title"> Dashboard </h2>
            <div class="pure-g">
                <div class="pure-u-1">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Attack <span id="attack-id-label"></span> - progress</h4>
                            <div class="progress-bar"><span id="total-percentage"></span></div>
                            <span class="info-text"><b>Expected time to complete (ETC)</b>: <span id="etc-label"></span></span>
                            <canvas id="myChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- THREE CARD ROW -->
            <div class="pure-g">
                <div class="pure-u-1-4">        
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title align-center">collisions found</h4>
                            <span class="info-card-text"> <i class="fas fa-arrow-up"></i> <span id='num-collisions-label'></span></span>
                        </div>
                    </div>
                </div>
                <div class="pure-u-3-4">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Other info</h4>
                        </div>
                    </div>				
                </div>
            </div>   
        </section>

        <section id="bucket-inspection" class="content-wrapper"> 
            <h2>Bucket Inspection</h2>
            <div id="bucket-inspector" class="card">
                <div class="card-body">
                    <h4 id="bucket-id" class="card-title"> {{title}} </h4>
                    <div class="progress-bar"><span id="bucket-progress"></span></div>
                    <span class="info-text"><b>Assigned to </b>: <span id="bucket-username-label"></span></span>
                    <span class="info-text"><b>Allocation Date</b>: <span id="bucket-allocation-date-label"></span></span>
                    <span class="info-text"><b>Last heartbeat</b>: <span id="bucket-last-heartbeat-label"></span></span>
                    <p>Some information about this bucket...</p>
                    <button class="button-error"> <i class="fas fa-trash"></i> Revoke</button>
                </div> 
            </div>

            <div class="pure-g">
                <div class="pure-u-2-3">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Heatmap</h4>
                            <!-- Bucket heatmap -->
                            <div id="heatmap">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pure-u-1-3">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Allocation</h4>
                            <canvas id="bucket-allocation-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- INCLUDE SCRIPTS -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js" crossorigin="anonymous"></script> 
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.0/dist/Chart.min.js"></script>
        <script src="js/main.js"></script>
        
        
        <script type="text/javascript">
            var webSocket = new WebSocket("ws://localhost:8080/DHBServer/test_ep/bucketid");

            var message = "msg";
            webSocket.onopen = function(message){ wsOpen(message);};
            webSocket.onmessage = function(message){ wsGetMessage(message);};
            webSocket.onclose = function(message){ wsClose(message);};
            webSocket.onerror = function(message){ wsError(message);};

            function wsOpen(message){
                console.log("Connected ... \n");
                webSocket.send("test");
            }
            function wsSendMessage(){
                webSocket.send(message.value);
                console.log("Message sended to the server : " + message.value + "\n");
                message.value = "";
            }
            function wsCloseConnection(){
                webSocket.close();
            }
            function wsGetMessage(message){
                console.log("Message received from to the server : " + message.data + "\n");
            }
            function wsClose(message){
                console.log("Disconnect ... \n");
            }

            function wsError(message){
                console.log("Error ... \n");
            }
    </script>
        
    </body>
</html>
